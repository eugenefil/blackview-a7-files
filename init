#!/bin/sh

/bin/busybox mkdir -p /sbin /usr/bin /usr/sbin
/bin/busybox --install -s
/bin/busybox-extras --install -s
export PATH=/bin:/usr/bin:/sbin:/usr/sbin

mkdir -p /sys /dev /proc
mount -t sysfs sysfs /sys
mount -t tmpfs tmpfs /dev
mount -t proc proc /proc
mkdir /dev/pts
mount -t devpts devpts /dev/pts

mknod -m 664 /dev/null c 1 3
mknod -m 664 /dev/urandom c 1 9
mknod -m 664 /dev/ptmx c 5 2
mknod -m 664 /dev/fb0 c 29 0
head -c $((32 * 4096)) /dev/urandom >/dev/fb0 # show we're alive

echo "0" >/sys/class/android_usb/android0/enable 
echo "dead" >/sys/class/android_usb/android0/idVendor 
echo "d00d" >/sys/class/android_usb/android0/idProduct 
echo "rndis" >/sys/class/android_usb/android0/functions 
echo "1" >/sys/class/android_usb/android0/enable 

while ! [ -e /sys/class/net/rndis0 ]; do sleep 1; done
ip link set rndis0 up
ip addr add 192.168.44.1/24 dev rndis0
telnetd -l /bin/sh

exec /bin/sh -i
